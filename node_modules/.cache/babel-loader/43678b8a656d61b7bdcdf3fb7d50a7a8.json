{"ast":null,"code":"import { db } from \"../firebase\";\nexport const handleEditProduct = (editableProduct, setProducts, callback) => {\n  db.collection(\"products\").doc(editableProduct.id).update({\n    name: editableProduct.name,\n    apps: editableProduct.apps,\n    pageURL: editableProduct.url\n  }).then(() => {\n    db.collection(\"products\").get().then(snapshot => {\n      setProducts([...snapshot.docs]);\n      updateProductsinUsers(editableProduct);\n      callback();\n    });\n  });\n};\nexport const handleAddNewProduct = (addedProduct, setProducts, callback) => {\n  db.collection(\"products\").add({\n    name: addedProduct.name,\n    apps: addedProduct.apps,\n    url: addedProduct.url\n  }).then(newProduct => {\n    db.collection(\"products\").get().then(snapshot => {\n      setProducts([...snapshot.docs]);\n      addNewProductToUsers(addedProduct, newProduct.id);\n      callback();\n    });\n  }).catch(error => {\n    console.error(\"Error writing document: \", error);\n  });\n};\nexport const handleDeleteProduct = (product, setProducts) => {\n  db.collection(\"products\").doc(product.id).delete().then(() => {\n    db.collection(\"products\").get().then(snapshot => {\n      setProducts([...snapshot.docs]);\n      deleteProductFromUsers(product.data().name);\n    });\n  }).catch(err => {\n    console.log(err);\n  });\n};\n\nconst updateProductsinUsers = product => {\n  db.collection(\"users\").get().then(snapshot => {\n    snapshot.docs.forEach(user => {\n      let products = user.data().products.filter(p => {\n        return product.id !== p.id;\n      });\n      let oldProduct = user.data().products.find(p => {\n        return product.id == p.id;\n      });\n      console.log(\"a name\", product);\n      let theNewProduct = {};\n      theNewProduct.name = product.name;\n      theNewProduct.url = product.url;\n      theNewProduct.id = product.id;\n      theNewProduct.apps = [];\n      product.apps.forEach(a => {\n        let exist = false;\n        let generatedApp = {};\n        oldProduct.apps.forEach(app => {\n          generatedApp.name = a;\n\n          if (app.name == a) {\n            exist = true;\n            generatedApp.active = app.active;\n          }\n        });\n\n        if (!exist) {\n          generatedApp.active = false;\n        }\n\n        theNewProduct.apps.push(generatedApp);\n      });\n      products.push(theNewProduct);\n      db.collection(\"users\").doc(user.id).set({\n        products\n      }, {\n        merge: true\n      });\n    });\n  });\n};\n\nconst deleteProductFromUsers = productName => {\n  db.collection(\"users\").get().then(snapshot => {\n    snapshot.docs.forEach(user => {\n      let products = user.data().products.filter(product => {\n        console.log(product.name, productName);\n        return product.name !== productName;\n      });\n      console.log(\"products is \", products);\n      db.collection(\"users\").doc(user.id).set({\n        products\n      }, {\n        merge: true\n      });\n    });\n  });\n};\n\nconst addNewProductToUsers = (product, productId) => {\n  db.collection(\"users\").get().then(snapshot => {\n    let theProduct = {};\n    theProduct.name = product.name;\n    theProduct.url = product.url;\n    theProduct.apps = [];\n    theProduct.id = productId; // theProduct.id = product.id;\n\n    product.apps.forEach(app => {\n      theProduct.apps.push({\n        name: app,\n        active: false,\n        purchased: false\n      });\n    });\n    snapshot.docs.forEach(user => {\n      let products = user.data().products;\n      products.push(theProduct);\n      db.collection(\"users\").doc(user.id).set({\n        products\n      }, {\n        merge: true\n      });\n    });\n  });\n}; // const resetUsersDetails = () =>{\n//     let products;\n//     db.collection(\"products\").get().then(snapshot=>{\n//         products = snapshot.docs;\n//         db.collection(\"users\").get().then(snapshot=>{\n//             snapshot.docs.forEach(user=>{\n//                 products.forEach(product=>{\n//                     user.products\n//                 })\n//             })\n//         })\n//     });  \n// }","map":{"version":3,"sources":["E:/Folder/React/projects/my_freelance_work/M.Ramdan Work/light-bootstrap-dashboard-react/src/views/ProductsActions.js"],"names":["db","handleEditProduct","editableProduct","setProducts","callback","collection","doc","id","update","name","apps","pageURL","url","then","get","snapshot","docs","updateProductsinUsers","handleAddNewProduct","addedProduct","add","newProduct","addNewProductToUsers","catch","error","console","handleDeleteProduct","product","delete","deleteProductFromUsers","data","err","log","forEach","user","products","filter","p","oldProduct","find","theNewProduct","a","exist","generatedApp","app","active","push","set","merge","productName","productId","theProduct","purchased"],"mappings":"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","sourcesContent":["import {  db } from \"../firebase\";\r\n\r\nexport const handleEditProduct = (editableProduct,setProducts,callback)=>{\r\n    db.collection(\"products\").doc(editableProduct.id).update({\r\n        name:editableProduct.name,\r\n        apps:editableProduct.apps,\r\n        pageURL:editableProduct.url,\r\n    }).then(()=>{\r\n        db.collection(\"products\").get()\r\n        .then(snapshot=>{\r\n            setProducts([...snapshot.docs]);\r\n            updateProductsinUsers(editableProduct)\r\n            callback();\r\n        })\r\n\r\n    })\r\n}\r\n\r\nexport const handleAddNewProduct = (addedProduct,setProducts,callback)=>{\r\n    db.collection(\"products\").add({\r\n        name: addedProduct.name,\r\n        apps: addedProduct.apps,\r\n        url: addedProduct.url\r\n    })\r\n    .then((newProduct) => {\r\n        db.collection(\"products\").get()\r\n        .then(snapshot=>{\r\n            setProducts([...snapshot.docs]);\r\n            addNewProductToUsers(addedProduct,newProduct.id)\r\n            callback()\r\n        })\r\n    })\r\n    .catch((error) => {\r\n        console.error(\"Error writing document: \", error);\r\n    });\r\n}\r\n\r\nexport const handleDeleteProduct = (product,setProducts)=>{\r\n    db.collection(\"products\").doc(product.id).delete()\r\n    .then(()=>{\r\n        db.collection(\"products\").get()\r\n        .then(snapshot=>{\r\n            setProducts([...snapshot.docs]);\r\n            deleteProductFromUsers(product.data().name);\r\n        })\r\n    })\r\n    .catch((err)=>{\r\n        console.log(err)\r\n    })\r\n\r\n}\r\n\r\n\r\nconst updateProductsinUsers = (product)=>{\r\n    db.collection(\"users\").get().then(snapshot=>{\r\n        snapshot.docs.forEach(user=>{\r\n            let products = user.data().products.filter(p=>{\r\n                return product.id !== p.id;\r\n            });\r\n\r\n            let oldProduct = user.data().products.find(p=>{\r\n                return product.id == p.id\r\n            })\r\n            \r\n            console.log(\"a name\",product)\r\n\r\n\r\n            let theNewProduct = {};\r\n            theNewProduct.name = product.name;\r\n            theNewProduct.url = product.url;\r\n            theNewProduct.id = product.id;\r\n            theNewProduct.apps = [];\r\n            product.apps.forEach((a)=>{\r\n                let exist = false;\r\n                let generatedApp   = {};\r\n                oldProduct.apps.forEach((app)=>{\r\n                    generatedApp.name = a;\r\n\r\n                    if(app.name == a){\r\n                        exist = true;\r\n                        generatedApp.active = app.active\r\n                    }\r\n                })\r\n\r\n                if(!exist){\r\n                    generatedApp.active = false;\r\n                }\r\n\r\n                theNewProduct.apps.push(generatedApp)\r\n            })\r\n\r\n            products.push(theNewProduct)\r\n            db.collection(\"users\").doc(user.id).set({\r\n                products\r\n            },{merge:true})\r\n        })\r\n    })\r\n}\r\n\r\nconst deleteProductFromUsers = (productName)=>{\r\n    db.collection(\"users\").get().then(snapshot=>{\r\n        snapshot.docs.forEach(user=>{\r\n            let products = user.data().products.filter(product=>{\r\n                console.log(product.name,productName)\r\n                return product.name !== productName;\r\n            });\r\n\r\n            console.log(\"products is \",products)\r\n            db.collection(\"users\").doc(user.id).set({\r\n                products\r\n            },{merge:true})\r\n        })\r\n    })\r\n}\r\nconst addNewProductToUsers = (product,productId)=>{\r\n    db.collection(\"users\").get().then(snapshot=>{\r\n        \r\n        let theProduct = {};\r\n        theProduct.name = product.name;\r\n        theProduct.url = product.url;\r\n        theProduct.apps = [];\r\n        theProduct.id = productId\r\n        // theProduct.id = product.id;\r\n        product.apps.forEach(app=>{\r\n            theProduct.apps.push({\r\n                name:app,\r\n                active:false,\r\n                purchased: false\r\n            })\r\n        })\r\n        \r\n        snapshot.docs.forEach(user=>{\r\n            let products = user.data().products;\r\n            products.push(theProduct);\r\n            db.collection(\"users\").doc(user.id).set({\r\n                products\r\n            },{merge:true})\r\n        })\r\n    })\r\n}\r\n\r\n\r\n// const resetUsersDetails = () =>{\r\n//     let products;\r\n//     db.collection(\"products\").get().then(snapshot=>{\r\n//         products = snapshot.docs;\r\n//         db.collection(\"users\").get().then(snapshot=>{\r\n//             snapshot.docs.forEach(user=>{\r\n//                 products.forEach(product=>{\r\n//                     user.products\r\n//                 })\r\n//             })\r\n//         })\r\n//     });  \r\n// }"]},"metadata":{},"sourceType":"module"}