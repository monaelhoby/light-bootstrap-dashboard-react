{"ast":null,"code":"import { db } from \"../../firebase\";\nexport const handleDeactiveApp = (user, product, theApp, setUser) => {\n  let newUser = user;\n  let editableProduct = newUser.products.find(p => {\n    return p.name == product.name;\n  });\n  newUser.products = newUser.products.filter(p => {\n    return p.name !== product.name;\n  });\n  editableProduct.apps.forEach(app => {\n    if (app.name.name == theApp.name.name) {\n      app.deviceId = \"\";\n    }\n  });\n  newUser.products.push(editableProduct);\n  setUser({ ...newUser\n  });\n  return db.collection('users').doc(user.id).set(newUser);\n};\nexport const handleDeactiveAllApps = (user, product, setUser, callback) => {\n  let newUser = user;\n  let editableProduct = newUser.products.find(p => {\n    return p.name == product.name;\n  });\n  newUser.products = newUser.products.filter(p => {\n    return p.name !== product.name;\n  });\n  editableProduct.apps.forEach(app => {\n    app.deviceId = \"\";\n  });\n  newUser.products.push(editableProduct);\n  setUser({ ...newUser\n  });\n  callback();\n  return db.collection('users').doc(user.id).set(newUser);\n};\nexport const handleInactiveCode = (code, prefixCode, theUser, theCodeObject, callback, setCode, setProductsActivated) => {\n  console.log(\"theCodeObject: \", theCodeObject.data(), \"theUser\", theUser);\n  db.collection(\"codes\").get().then(snapshot => {\n    let activeCodeObject = {};\n    snapshot.docs.forEach(oneCode => {\n      if (Array.isArray(oneCode.data().code)) {\n        let activeCode = \"\";\n        activeCode = oneCode.data().code.find(singleCode => singleCode == code);\n\n        if (activeCode) {\n          activeCodeObject = oneCode.data();\n        }\n      } else if (!Array.isArray(oneCode.data().code)) {\n        if (oneCode.data().code == code) {\n          activeCodeObject = oneCode.data();\n        } else {\n          return;\n        }\n      }\n    });\n    db.collection(\"inactiveCodes\").add({\n      inactiveCode: code,\n      activatedBy: theUser.email,\n      firstName: theUser.firstName,\n      lastName: theUser.lastName,\n      prefixCode: prefixCode,\n      dataAdded: new Date().toLocaleString(),\n      placeOfPurchase: theCodeObject.data().purchasedLocation,\n      productActivated: theCodeObject.data().productActivated,\n      products: theCodeObject.data().products,\n      notes: theCodeObject.data().notes,\n      suffixCode: theCodeObject.data().suffixCode\n    }).then(() => {\n      // console.log(theCodeObject.data().productActivated)\n      db.collection(\"codes\").doc(theCodeObject.id).delete();\n      updateAppsinUser(theCodeObject.data().productActivated, theUser.id, code, setProductsActivated);\n      setCode();\n      callback(); // window.location.reload(false);\n    });\n  }).catch(err => {\n    console.log(err);\n  });\n};\n\nconst updateAppsinUser = (productsActivated, id, code, setProductsActivated) => {\n  db.collection(\"users\").doc(id).get().then(snapshot => {\n    let allProducts = snapshot.data().products; // console.log(\"allProducts before\",productsActivated);\n\n    productsActivated ? productsActivated.forEach(product => {\n      product.apps ? product.apps.forEach(acivatedApp => {\n        allProducts.forEach((piu, i) => {\n          if (piu.name === product.name) {\n            piu.apps.forEach((app, j) => {\n              if (app.name === acivatedApp) {\n                allProducts[i].apps[j].purchased = true;\n                allProducts[i].apps[j].codeUsed = code;\n                allProducts[i].apps[j].activatedOn = new Date().toLocaleString();\n              }\n            });\n          }\n        });\n      }) : null;\n      product.features ? product.features.forEach(activatedFeature => {\n        allProducts.forEach((piu, i) => {\n          if (piu.name === product.name) {\n            piu.features.forEach((feature, k) => {\n              if (feature.name === activatedFeature) {\n                allProducts[i].features[k].purchased = true;\n                allProducts[i].features[k].codeUsed = code;\n                allProducts[i].features[k].activatedOn = new Date().toLocaleString();\n              }\n            });\n          }\n        });\n      }) : null;\n    }) : null; // console.log(\"allProducts after\",allProducts)\n\n    setProductsActivated(allProducts);\n    db.collection(\"users\").doc(id).set({\n      products: allProducts\n    }, {\n      merge: true\n    });\n  }).catch(err => {\n    console.log(err);\n  });\n};","map":{"version":3,"sources":["E:/Folder/React/projects/my_freelance_work/M.Radwan Work/light-bootstrap-dashboard-react/src/components/userPortal/appAction.js"],"names":["db","handleDeactiveApp","user","product","theApp","setUser","newUser","editableProduct","products","find","p","name","filter","apps","forEach","app","deviceId","push","collection","doc","id","set","handleDeactiveAllApps","callback","handleInactiveCode","code","prefixCode","theUser","theCodeObject","setCode","setProductsActivated","console","log","data","get","then","snapshot","activeCodeObject","docs","oneCode","Array","isArray","activeCode","singleCode","add","inactiveCode","activatedBy","email","firstName","lastName","dataAdded","Date","toLocaleString","placeOfPurchase","purchasedLocation","productActivated","notes","suffixCode","delete","updateAppsinUser","catch","err","productsActivated","allProducts","acivatedApp","piu","i","j","purchased","codeUsed","activatedOn","features","activatedFeature","feature","k","merge"],"mappings":"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","sourcesContent":["import { db } from \"../../firebase\";\r\n\r\n\r\nexport const handleDeactiveApp = (user,product,theApp,setUser) => {\r\n    let newUser = user;\r\n    let editableProduct = newUser.products.find(p=>{\r\n        return p.name == product.name;\r\n    })\r\n    \r\n    newUser.products = newUser.products.filter(p=>{\r\n        return p.name !== product.name;\r\n    })\r\n\r\n    editableProduct.apps.forEach(app => {\r\n        if (app.name.name == theApp.name.name){\r\n            app.deviceId = \"\";\r\n        }\r\n    });\r\n    newUser.products.push(editableProduct);\r\n    setUser({...newUser})\r\n\r\n    return db.collection('users').doc(user.id).set(newUser) \r\n    \r\n  }\r\n\r\n  export const handleDeactiveAllApps = (user,product,setUser,callback) => {\r\n    let newUser = user;\r\n    let editableProduct = newUser.products.find(p=>{\r\n        return p.name == product.name;\r\n    })\r\n    \r\n    newUser.products = newUser.products.filter(p=>{\r\n        return p.name !== product.name;\r\n    })\r\n\r\n    editableProduct.apps.forEach(app => {\r\n            app.deviceId = \"\";\r\n    });\r\n    newUser.products.push(editableProduct);\r\n    setUser({...newUser})\r\n    callback()\r\n    return db.collection('users').doc(user.id).set(newUser) \r\n    \r\n  }\r\n\r\n  export const handleInactiveCode = (code,prefixCode, theUser, theCodeObject,callback,setCode,setProductsActivated) => {\r\n      console.log(\"theCodeObject: \",theCodeObject.data(),\"theUser\",theUser)\r\n    db.collection(\"codes\").get()\r\n    .then(snapshot => {\r\n    let activeCodeObject = {};\r\n    snapshot.docs.forEach(oneCode => {\r\n        if(Array.isArray(oneCode.data().code)){\r\n            let activeCode = \"\";\r\n            activeCode = oneCode.data().code.find(singleCode => singleCode==code);\r\n            if(activeCode){\r\n                activeCodeObject = oneCode.data() \r\n            }\r\n        }else if(!Array.isArray(oneCode.data().code)){\r\n            if(oneCode.data().code == code) {\r\n                activeCodeObject = oneCode.data() \r\n            }else{\r\n                return\r\n            }\r\n        }\r\n    })\r\n    db.collection(\"inactiveCodes\").add({\r\n        inactiveCode : code,\r\n        activatedBy : theUser.email,\r\n        firstName : theUser.firstName,\r\n        lastName : theUser.lastName,\r\n        prefixCode : prefixCode,\r\n        dataAdded : new Date().toLocaleString(),\r\n        placeOfPurchase: theCodeObject.data().purchasedLocation,\r\n        productActivated: theCodeObject.data().productActivated,\r\n        products: theCodeObject.data().products,\r\n        notes: theCodeObject.data().notes,\r\n        suffixCode: theCodeObject.data().suffixCode\r\n    }).then(() => {\r\n        // console.log(theCodeObject.data().productActivated)\r\n        db.collection(\"codes\").doc(theCodeObject.id).delete()\r\n        updateAppsinUser(theCodeObject.data().productActivated,theUser.id,code, setProductsActivated)\r\n        setCode()\r\n        callback()\r\n        // window.location.reload(false);\r\n    })\r\n    }).catch(err => {\r\n        console.log(err)\r\n    })\r\n  }\r\n\r\n  const updateAppsinUser = (productsActivated, id,code, setProductsActivated)=>{\r\n    db.collection(\"users\").doc(id).get()\r\n    .then(snapshot=>{\r\n        let allProducts=snapshot.data().products\r\n        // console.log(\"allProducts before\",productsActivated);\r\n\r\n        productsActivated ? productsActivated.forEach((product) => {\r\n            product.apps ? product.apps.forEach((acivatedApp) => {\r\n                allProducts.forEach((piu,i)=>{\r\n                    if(piu.name === product.name){\r\n                        piu.apps.forEach((app,j)=>{\r\n                            if(app.name === acivatedApp){\r\n                                allProducts[i].apps[j].purchased = true\r\n                                allProducts[i].apps[j].codeUsed = code\r\n                                allProducts[i].apps[j].activatedOn = new Date().toLocaleString()\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n            }) : null\r\n            product.features ? product.features.forEach(activatedFeature => {\r\n                allProducts.forEach((piu,i)=>{\r\n                    if(piu.name === product.name){\r\n                        piu.features.forEach((feature,k)=>{\r\n                            if(feature.name === activatedFeature){\r\n                                allProducts[i].features[k].purchased = true\r\n                                allProducts[i].features[k].codeUsed = code\r\n                                allProducts[i].features[k].activatedOn = new Date().toLocaleString()\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n            }) : null\r\n        }) : null\r\n        // console.log(\"allProducts after\",allProducts)\r\n        setProductsActivated(allProducts)\r\n        db.collection(\"users\").doc(id).set({\r\n            products: allProducts\r\n        },{merge:true})\r\n        }).catch(err => {\r\n            console.log(err)\r\n        })\r\n}"]},"metadata":{},"sourceType":"module"}